# Elastic Basics

## Overview
This project demonstrates how the Elastic Stack (ELK) is used for log analysis within a SOC workflow.
We will follow the process of exploring Kibana, performing KQL searches, analyzing VPN logs, and creating visualizations and dashboards.

---

## 1. Objective

- Understand the components of the Elastic Stack (Elasticsearch, Logstash, Beats, Kibana)  
- Navigate Kibana’s Discover, Visualization, and Dashboard features  
- Use KQL (Kibana Query Language) to filter and investigate logs  
- Analyze VPN logs for anomalies and suspicious activity  
- Build visualizations and a custom VPN dashboard  

---

## 2. Elastic Stack Overview

### Elasticsearch  
Search and analytics engine that stores JSON documents and provides full-text search across indexed data.

### Logstash  
Data pipeline engine with input, filter, and output stages.  
Commonly used to normalize data before sending it to Elasticsearch.

### Beats  
Lightweight host-based agents used to ship logs and telemetry.  
Examples: Winlogbeat (Windows logs), Filebeat (log files), Packetbeat (network flows).

### Kibana  
Web interface for analysts to search, filter, visualize, and build dashboards from Elasticsearch data.

### Data Flow (High-Level)  
1. Beats collect logs from endpoints  
2. Logstash normalizes and forwards data  
3. Elasticsearch indexes and stores events  
4. Kibana provides the interface for analysis and investigation  

---

## 3. Kibana Discover Interface

The **Discover** tab is the primary workspace for analysts. It provides:

- Raw events  
- Field list with value counts  
- Time filter  
- Timeline histogram  
- KQL search bar  
- Filter creation using GUI  
- Ability to build clean tables from selected fields  

### Key Elements
- **Index Pattern:** Logical grouping of logs (e.g., `vpn_connections`)  
- **Fields Pane:** Normalized fields extracted from logs  
- **Search Bar:** Accepts KQL queries  
- **Time Filter:** Controls event visibility  
- **Timeline:** Displays event frequency over time  
- **Add Filter:** GUI-based field filtering  

---

## 4. KQL Searches (Filtering & Investigation)

KQL supports two main types of searches analysts use during investigations.

### A. Free-Text Search
Searches for a string across **all fields**.
```
"failed"
```

---

### B. Field-Based Filtering
More precise — targets specific fields and values.

```
event.action : "login-failed"
src_ip : "10.0.0.5"
username : "jsmith"
```

Combined conditions:
```
event.action : "login-failed" AND username : "jsmith"
```

Wildcards:
```
username : "j*"
```

Negation:
```
NOT src_ip : "10.0.0.5"
```

---

### Common KQL Queries for VPN Log Analysis

**1. Failed Logins**
```
event.action : "login-failed"
```

**2. Successful Logins from New Geo-Locations**
```
event.action : "login-success" AND NOT src_geo.country : "United States"
```

**3. Excessive Login Attempts**
```
username : "jsmith" AND event.action : "login-failed"
```

**4. Suspicious IP Ranges**
```
src_ip : "185.*"
```

**5. High-Risk Countries**
```
src_geo.country : ("Russia" or "China" or "Iran")
```

---

## 5. VPN Log Analysis

During analysis, focus on:

### 1. Login Behavior
- Failed vs successful attempts  
- Repeated failures from same IP  
- Logins outside typical hours  

### 2. Geographical Patterns
- New/unusual countries  
- Impossible travel logins  

### 3. Device & IP Fingerprints
- Same username from new devices  
- Same device used by multiple users  

### 4. Session Durations
- Very short sessions  
- Long sessions with no activity  

### 5. Correlation With Alerts
- Validate SIEM alerts with raw log evidence  

---

## 6. Visualizations

Recommended visualizations for VPN monitoring:

### 1. Top Source IPs  
Bar chart  
- X-axis: `src_ip`  
- Y-axis: Count  

### 2. Login Outcome Breakdown  
Pie chart  
- Field: `event.action`  

### 3. Login Attempts Over Time  
Line/Area chart  
- X-axis: `@timestamp`  
- Y-axis: Count  
- Filter: `event.action : "login-failed"`  

### 4. Top Countries  
Bar or map chart  
- X-axis: `src_geo.country`  

---

## 7. Dashboard Creation

Create a dashboard named **“VPN Activity Dashboard”** containing:

- Login attempts over time  
- Top source IPs  
- Top countries  
- Login success/failure pie chart  
- Saved filters (failed logins, foreign logins, etc.)  

Dashboard best practices:
- Enable **auto-refresh** (15–30s)  
- Apply **global time range**  
- Use unified filters  

---

## 8. Summary

This project demonstrates how the Elastic Stack supports SOC investigations through:

- Log exploration with Kibana Discover  
- KQL-based filtering  
- VPN anomaly detection  
- Visualizations for pattern identification  
- Dashboard creation for continuous monitoring  

